# AI Orchestration Session Summary
**Date:** 2025-11-27

## What We Built

### 1. Visual Development Loop (`visual-loop/`)
- **auto.sh** - Autonomous edit → screenshot → verify → iterate loop
- **orchestrate.sh** - Runs task_list.json, tracks progress, commits on success
- **snap.sh** - Enhanced with `--path` and `--delay` flags
- **task_list.json** - Task definitions with verification patterns

### 2. AI-to-AI Orchestration Pipeline
Flow: `task_list.json → orchestrate.sh → auto.sh → codex → verify → commit`

Key features:
- Code-only verification via regex patterns (`--verify-code`)
- Visual verification via screenshot + vision model
- Progress tracking in `.orchestrate_progress`
- Automatic git commits on task success
- Stream filtering (`--stream visual`, `--stream core`)

## Commits Generated by AI Pipeline

| Commit | Feature |
|--------|---------|
| `fc5fa7e` | Q key for auto-attack (keyboard listener) |
| `614c5e9` | selectLowHPTarget AI helper function |
| `bc271b2` | Shake animation on damage |
| `ebb9b7e` | Glowing title border |
| `e5217c4` | Shimmer effect on Press Start |

## Task List Format

```json
{
  "id": "feature-001",
  "task": "Natural language description",
  "stream": "visual|core|content|polish",
  "context_files": "File.tsx,File.css",
  "verify_code": "regex|pattern|to|match"
}
```

## Key Learnings

1. **File paths must be accurate** - Task list failed when referencing non-existent files (QueueBattleView.css vs battle-screen.css)

2. **Visual verification limited to landing page** - Can only screenshot what loads at URL; need URL params or code verification for other screens

3. **Code verification works well** - `--verify-code` with regex patterns is reliable for CSS/JS changes

4. **Context matters** - Providing file contents with line numbers helps AI make accurate edits

## Commands

```bash
# Run full pipeline
./orchestrate.sh

# Dry run (preview)
./orchestrate.sh --dry-run

# Run specific stream
./orchestrate.sh --stream visual

# Skip completed tasks
./orchestrate.sh --start-from 3

# Human review mode
./orchestrate.sh --review

# Single task with visual loop
./auto.sh "Add button to header" --context-files "Header.tsx,Header.css"

# Code-only verification (skip vision)
./auto.sh "Add animation" --verify-code "@keyframes.*fade"
```

## Architecture Decisions

- **Gap-filling approach** - Continue existing 85% complete codebase rather than rebuild
- **Sequential execution** - Simpler than parallel, easier to debug
- **Milestone-based oversight** - AI runs autonomously, human reviews at phase boundaries
- **Code verification preferred** - More reliable than visual for non-landing-page features

## Next Steps

1. Add more tasks to task_list.json for remaining Vale Village features
2. Add URL param to Vale Village for direct battle mode access (enables visual verification)
3. Build `generate_tasks.sh` that scans codebase for accurate file names
4. Try parallel stream execution once single-stream is stable
